//////////////////////////////////////////////////////////////////////
// enkaigei.cpp 多倍長精度整数クラスのテスト「ガマの油売り」
//                 first type : 1992-10-10
//

#include <conio.h>
#include <iostream.h>

#include "LLint.h"

#define		MESNUM		8					// 終了までのメッセージ数

//////////////////////////////////////////////////////////////////////
// プロトタイプ宣言と大域変数
//
void	maekoujou(void);					// 前口上
void	ending1(void);						// エンディングその1
void	ending2(void);						// エンディングその2
void	hit_any_key(void);					// 何かのキーを押してね

static char	*mes[MESNUM] = {
	"　まぁ〜だ、始まったばかりぢゃろぉ。\n",
	"　まだ始まったばかりと言っておろうが。\n",
	"　そう急がんと、もっとゆっくり聞いていきなされ。\n",
	"　まだまだ細かく切れるんぢゃゾ\n",
	"　何をそんなに急いでいるのぢゃ？\n",
	"　人の話しは最後まで聞くのが礼儀っちゅ〜もんぢゃゾ。\n",
	"　おぬし、まわりから『つき合いの悪い奴』と言われとらんか？\n",
	"　そんなにわしの話しを聞くのが嫌なのか？(悲)\n"
};

//////////////////////////////////////////////////////////////////////
// メイン
//
__cdecl main()
{
	maekoujou();							// 前口上
	cout << "\n  この 1枚の紙が2枚に。\n";
	LLint	Maisuu(2);
	int		escin = 0;						// ESCを押した回数
	Maisuu.SetOverAbote(FALSE);				// overflowしても無視する
	for(;;) {
		cout << "  " << Maisuu << "枚が";
		Maisuu *= 2;						// 二倍する
		if(IsOverFlow(Maisuu)) {			// 枚数がoverflowしてたら
			break;							// ループから抜ける
		} else {							// そうじゃなければ
			cout << Maisuu << "枚。\n";		// 枚数表示
		}
		if(kbhit()) {						// 何かキーを押してたら
			if(getch() == 0x1b) {			// それがESCだったら
				if(escin < MESNUM) {		// MESNUM回以内なら
					cout << "　……おお、これこれ。\n\n";
					cout << mes[escin] << endl;	// メッセージ表示
					hit_any_key();
					escin++;
				} else {					// MESNUM回になったら
					ending2();				// おしまい
					return -1;
				}
			}
		}
	}
	ending1();								// ループ抜けたら終り
	return 0;
}

//////////////////////////////////////////////////////////////////////
// 前口上
//
void	maekoujou(void)
{
	cout << "  さァさァお立ち会い。\n"
			"  ご用とお急ぎのない方は、ゆっくりと聞いていらっしゃい。\n"
			"  遠出山越え笠のうち、聞かざるときは、ものの白黒、出方、善悪"
			"がとんと分からない。山寺の鐘がゴーン、ゴーンと鳴るといえども、"
			"童児きたって撞木を当てざれば、とんと鐘の音色が分からない。\n"
			"  さて、お立ち会い。\n";
	hit_any_key();
	cout << "  手前、ここに取り出しましたるは万金膏ガマの油。"
			"ガマと申しましても普通のガマとは違う。これよりはるゥか南、"
			"南は筑波山の麓、オオバコという露草を食って育った四六のガマだ。\n"
			"  四六、五六はどこで見分けるか。前足の指が四本、後足の指六本、"
			"指を合わせて四六のガマだ。"
			"山中深く分け入って捕えましたるこのガマを、四面鏡張りの箱に入れる"
			"ときは、ガマは奇怪なおのが姿の鏡に映るのを見て驚き、タラーリ、"
			"タラーリと油汗を流す。この油汗を柳の小枝にて、三七、二十一日の"
			"間、トローリ、トローリと煮つめましたるが、"
			"万金膏はガマの油！\n";
	hit_any_key();
	cout << "  このガマの油の効能は、ヒビにアカギレ、シモヤケの妙薬だ。\n"
			"  まだある。大の男が七転八倒する虫歯の痛みもぴったり止まる。\n"
			"  まだある、まだある。大きな声じゃあ言えねえが、淋病、梅毒の"
			"特効薬だ。\n";
	hit_any_key();
	cout << "\n  しかし、口上だけじゃあ信用がおけんだろう。\n"
			"  刀の切れ味を止めて見せようか。"
			"抜き放ちたるは、夏なお冷たき氷のやいば。\n";
	hit_any_key();
}

//////////////////////////////////////////////////////////////////////
// エンディングその1
//
void	ending1(void)
{
	cout << "ほゥれごろうじろ、この通りぃ！！！\n\n"
			"　フッと散らせば、京嵐山は落花の舞っ。\n";
	hit_any_key();
	cout << "　これなる名刀も、一たびこのガマの油をつけるときはたちまちに"
			"してなまくら、押しても引いても切れはせぬ。\n";
	hit_any_key();
	cout << "　さァさァ、ガマの油の効能が分かったら、"
			"買っていらっしゃい。\n";
}

//////////////////////////////////////////////////////////////////////
// エンディングその2
//
void	ending2(void)
{
	cout << "　……おお、これこれ。\n\n"
			"　まだ話しの途中なのに帰ってしまうとは……。\n"
			"　まったく、現代人というのは忙しいものよのぉ。\n";
}

//////////////////////////////////////////////////////////////////////
// 何かのキーを押してください
//
void	hit_any_key(void)
{
	cout << flush << "\33[47m--hit any key--\33[m" << flush;
	getch();
	cout << "\r                 \r" << flush;
}
